<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - VIT Bus</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .chat-container {
            height: calc(100vh - 200px);
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col h-screen">

    <!-- Header -->
    <header class="text-gray-600 body-font bg-white shadow">
        <div class="container mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center">
            <a href="{{ url_for('home') }}" class="flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0">
                <span class="ml-3 text-xl">VIT Bus AI Assistant</span>
            </a>
            <nav class="md:ml-auto flex flex-wrap items-center text-base justify-center">
                <a href="{{ url_for('home') }}" class="mr-5 hover:text-gray-900">Back to Home</a>
            </nav>
        </div>
    </header>

    <!-- Chat Area -->
    <div class="container mx-auto p-4 flex-grow flex flex-col">
        <div id="chat-box" class="flex-grow bg-white p-4 rounded shadow overflow-y-auto mb-4 space-y-4">
            <!-- Messages will appear here -->
            <div class="flex items-start">
                <div class="bg-gray-200 p-3 rounded-lg text-sm text-gray-900 max-w-xs">
                    Hello! I'm the VIT Bus AI. Ask me about bus routes or schedules! ðŸšŒ
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="flex">
            <input type="text" id="user-input"
                class="flex-grow p-3 border rounded-l focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Type your question..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()"
                class="bg-indigo-500 text-white p-3 rounded-r hover:bg-indigo-600 transition">Send</button>
        </div>
    </div>

    <script>
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            const chatBox = document.getElementById('chat-box');

            if (!message) return;

            // Add User Message
            chatBox.innerHTML += `
                <div class="flex items-end justify-end">
                    <div class="bg-indigo-500 text-white p-3 rounded-lg text-sm max-w-xs">
                        ${message}
                    </div>
                </div>`;

            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            // Show Loading
            const loadingId = 'loading-' + Date.now();
            chatBox.innerHTML += `
                <div id="${loadingId}" class="flex items-start">
                    <div class="bg-gray-200 p-3 rounded-lg text-sm text-gray-500 max-w-xs animate-pulse">
                        Thinking...
                    </div>
                </div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();

                // Remove Loading
                document.getElementById(loadingId).remove();

                // Add AI Message
                chatBox.innerHTML += `
                    <div class="flex items-start">
                        <div class="bg-gray-200 p-3 rounded-lg text-sm text-gray-900 max-w-xs">
                            ${data.response}
                        </div>
                    </div>`;
            } catch (error) {
                document.getElementById(loadingId).remove();
                chatBox.innerHTML += `
                    <div class="flex items-start">
                        <div class="bg-red-100 text-red-700 p-3 rounded-lg text-sm max-w-xs">
                            Sorry, I encountered an error. Please try again.
                        </div>
                    </div>`;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }
    </script>
</body>

</html>